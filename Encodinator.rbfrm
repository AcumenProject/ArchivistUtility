#tag WindowBegin Window Encodinator   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   4.37e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   98570071   MenuBarVisible  =   True   MinHeight       =   300   MinimizeButton  =   True   MinWidth        =   720   Placement       =   0   Resizeable      =   True   Title           =   "Encodinator"   Visible         =   True   Width           =   8.22e+2   Begin Listbox difference_list      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   3      ColumnsResizable=   ""      ColumnWidths    =   "1*,1*,120"      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   True      HeadingIndex    =   -1      Height          =   391      HelpTag         =   ""      Hierarchical    =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   "UTF-8	ISO-8859-1	Source"      Italic          =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   46      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   822      _ScrollWidth    =   -1   End   Begin PushButton LoadFile      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Load File..."      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin StaticText filename      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   132      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      Text            =   "file name here"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   192   End   Begin PopupMenu popEncoding      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   0      InitialParent   =   ""      InitialValue    =   "ISO-8859-1"      Italic          =   ""      Left            =   520      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   120   End   Begin PushButton Refresh      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Refresh"      Default         =   ""      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   428      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin PopupMenu popEncoding      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   1      InitialParent   =   ""      InitialValue    =   "UTF-8"      Italic          =   ""      Left            =   682      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   13      Underline       =   ""      Visible         =   True      Width           =   120   End   Begin StaticText captionstring      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   652      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      Text            =   "to"      TextAlign       =   1      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   18   End   Begin PushButton Replace      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Replace..."      Default         =   ""      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   336      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Underline       =   ""      Visible         =   True      Width           =   80   EndEnd#tag EndWindow#tag WindowCode	#tag Method, Flags = &h0		Sub ShowDifferences(f as folderitem)		  dim enc1, enc2 as TextEncoding		  dim row, col as integer		  dim c1, c2, s as string		  dim i as integer		  		  if currentFile = nil then		    return		  end if		  		  enc1 = EncodingByName( popEncoding(0).text )		  enc2 = EncodingByName( popEncoding(1).text )		  e1 = new spreadsheet( f, enc1 )		  e2 = new spreadsheet( f, enc2 )		  		  if e1.rowcount <> e2.rowcount or e1.colcount <> e2.colcount then		    MsgBox "Encodings are too incompatible. Try different options."		    return		  end if		  		  difference_list.deleteAllRows		  		  filename.caption = f.name		  		  for row = 0 to e1.rowcount - 1		    for col = 0 to e1.colcount - 1		      if e1.cell(row, col) <> e2.cell(row, col) then		        difference_list.addrow( e1.cell(row, col) )		        difference_list.cell( difference_list.LastIndex, 1 ) = e2.cell( row, col )		        difference_list.cell( difference_list.LastIndex, 2 ) = "R" + format(row, "0000") + " C" + format(col, "0000")		        difference_list.celltag( difference_list.LastIndex, 2 ) = new IntPoint2D( col, row )		      end if		    next		  next		End Sub	#tag EndMethod	#tag Property, Flags = &h0		CurrentFile As folderitem	#tag EndProperty	#tag Property, Flags = &h0		e1 As spreadsheet	#tag EndProperty	#tag Property, Flags = &h0		e2 As spreadsheet	#tag EndProperty	#tag Property, Flags = &h0		which_column As Integer	#tag EndProperty#tag EndWindowCode#tag Events difference_list	#tag Event		Function CellClick(row as Integer, column as Integer, x as Integer, y as Integer) As Boolean		  if column < 2 then		    me.cellType( row, column ) = 3		  end if		End Function	#tag EndEvent	#tag Event		Sub CellLostFocus(row as Integer, column as Integer)		  dim p as IntPoint2D		  		  if column < 2 then		    me.cellType( row, column ) = 0		    p = IntPoint2D( me.celltag( row, 2 ) )		    if column = 0 then		      e1.cell( p.row, p.col ) = me.cell( row, column )		    else		      e2.cell( p.row, p.col ) = me.cell( row, column )		    end if 		  end if		End Sub	#tag EndEvent	#tag Event		Function ConstructContextualMenu(base as MenuItem, x as Integer, y as Integer) As Boolean		  if e1 <> nil and e2 <> nil then		    base.append new MenuItem( "Export " + me.heading(0), 0 )		    base.append new MenuItem( "Export " + me.heading(1), 1 )		  end if		End Function	#tag EndEvent	#tag Event		Function ContextualMenuAction(hitItem as MenuItem) As Boolean		  dim ss as spreadsheet		  		  if hitItem.tag = 0 then		    ss = e1		  else		    ss = e2		  end if		  		  		  dim f as folderItem		  f = GetSaveFolderItem( EncodinatorFileTypes.Text, ss.encoding + "_" + ss.sourceFile.name )		  if f <> nil then		    ss.SaveToFile f		  end if		End Function	#tag EndEvent#tag EndEvents#tag Events LoadFile	#tag Event		Sub Action()		  dim f as folderitem		  		  f = GetOpenFolderItem( "????" )		  		  if f <> nil then		    CurrentFile = f		    		    // Convert.enabled = true		    		    ShowDifferences f		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events filename	#tag Event		Sub Open()		  me.caption = ""		End Sub	#tag EndEvent#tag EndEvents#tag Events popEncoding	#tag Event		Sub Open(index as Integer)		  dim i as integer		  dim initial_value as string		  		  initial_value = me.text		  		  me.DeleteAllRows		  		  for i = 0 to encodings.count - 1		    me.addRow encodings.item(i).internetName		    if encodings.item(i).internetName = initial_value then		      me.ListIndex = i		    end if		  next		End Sub	#tag EndEvent	#tag Event		Sub Change(index as Integer)		  difference_list.heading(index) = popEncoding(index).text		  		  ShowDifferences CurrentFile		End Sub	#tag EndEvent#tag EndEvents#tag Events Refresh	#tag Event		Sub Action()		  dim t as string		  dim dest as folderItem		  		  t = CurrentFile.LoadAllText( popEncoding(0).text )		  		  dest = GetSaveFolderItem( "????", "Copy of " + currentfile.name )		  		  t = ConvertEncoding( t, EncodingByName( popEncoding(1).text ) )		  		  dest.SaveAllText( t )		End Sub	#tag EndEvent#tag EndEvents#tag Events Replace	#tag Event		Sub Action()		  dim t as string		  dim dest as folderItem		  		  t = CurrentFile.LoadAllText( popEncoding(0).text )		  		  dest = GetSaveFolderItem( "????", "Copy of " + currentfile.name )		  		  t = ConvertEncoding( t, EncodingByName( popEncoding(1).text ) )		  		  dest.SaveAllText( t )		End Sub	#tag EndEvent#tag EndEvents